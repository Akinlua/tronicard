<!DOCTYPE html>
{% load static %}
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="TemplateMo">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i&display=swap" rel="stylesheet">
    <!-- <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}"> -->
    <title>Tronicard</title>

    <!-- Bootstrap core CSS -->
    <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">


    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="{% static 'assets/css/fontawesome.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/templatemo-stand-blog.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/owl.css' %}">
<!--

TemplateMo 551 Stand Blog

https://templatemo.com/tm-551-stand-blog

-->
  </head>

  <body>

    <!-- ***** Preloader Start ***** -->
    <div id="preloader">
        <div class="jumper">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>  
    <!-- ***** Preloader End ***** -->

    <!-- Header -->
    {% include 'navbar.html' %}

    <!-- Page Content -->
    <!-- Banner Starts Here -->
    <div class="heading-page header-text">
      <section class="page-heading">
        <div class="container">
          <div class="row">
            <div class="col-lg-12">
              <div class="text-content">
                <h4>Post Details</h4>
                <h2>Single blog post</h2>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
    
    <!-- Banner Ends Here -->

    <section class="call-to-action">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="main-content">
              <div class="row">
                <div class="col-lg-8">
                  <span>Stand Blog HTML5 Template</span>
                  <h4>Creative HTML Template For Bloggers!</h4>
                </div>
                <div class="col-lg-4">
                  <div class="main-button">
                    <a rel="nofollow" href="https://templatemo.com/tm-551-stand-blog" target="_parent">Download Now!</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>


    <section class="blog-posts grid-system">
      <div class="container">
        <div class="row">
          <div class="col-lg-8">
            <div class="all-blog-posts">
              <div class="row">
                <div class="col-lg-12">
                  <div class="blog-post">
                    <div class="blog-thumb">
                      <img  src="{{blog.blog_image.url}}" alt="">
                    </div>
                    <div class="down-content">
                      {% if blog.addcategory == 'none' %}
                      <span>{{blog.categories.name}}</span>
                      {% elif blog.addcategory %}
                      <span>{{blog.addcategory}}</span>
                      {% else %}
                      <span>{{blog.categories.name}}</span>
                     
                      
                      {% endif %}
                      <a href="{% url 'singleblog' blog.id %}"><h4>{{blog.title}}</h4></a>
                      <ul class="post-info">
                        <li><a href="#">Admin</a></li>
                        <li><a href="#">{{blog.created}}</a></li>
                        <li><a href="{% url 'singleblog' blog.id %}#com">{{blog.comments_set.all.count}} Comment{{blog.comments_set.all.count|pluralize:"s"}}</a></li>
                      </ul>
                      <p>{{blog.body|linebreaksbr}}</p>
                      <div class="post-options">
                        <div class="row">
                          <div class="col-6">
                            <ul class="post-tags">
                              {% if blog.tags.all %}
                                
                                    <li><i class="fa fa-tags"></i></li>
                                    {% for tag in blog.tags.all %}
                                    <li><a >{{tag.name}}</a>
                                    {% if blog.tags.last == tag %}
                                    {% else %}
                                    ,
                                    {% endif %}
                                    </li>
                                    {% endfor %}
                                  {% if blog.addtag %}
                                    <li><a>, {{blog.addtag}}</a></li>
                                  {% endif %}
                              {% else %}
                                 {% if blog.addtag %}   
                                <li><i class="fa fa-tags"></i></li>
                                <li><a>{{blog.addtag}}</a></li>
                                {% endif %}
                              {% endif %}
                            </ul>
                          </div>
                          <div class="col-6">
                            <ul class="post-share">
                              <li><i class="fa fa-share-alt"></i></li>
                              <li><a href="#">Facebook</a>,</li>
                              <li><a href="#"> Twitter</a></li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                
                {% include 'blog/comments.html' with comments=comments comment_count=comment_count %}
                
              </div>
            </div>
          </div>
          {% include 'side.html' %}
        </div>
      </div>
    </section>

    {% include 'footer.html' %}

    
    <!-- Bootstrap core JavaScript -->
    <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

    <!-- Additional Scripts -->
    <script src="{% static 'assets/js/custom.js' %}"></script>
    <script src="{% static 'assets/js/owl.js' %}"></script>
    <script src="{% static 'assets/js/slick.js' %}"></script>
    <script src="{% static 'assets/js/isotope.js' %}"></script>
    <script src="{% static 'assets/js/accordions.js' %}"></script>

   
    <script language = 'text/Javascript'> 
      cleared[0] = cleared[1] = cleared[2] = 0; //set a cleared flag for each field
      function clearField(t){                   //declaring the array outside of the
      if(! cleared[t.id]){                      // function makes it static and global
          cleared[t.id] = 1;  // you could use true and false, but that's more typing
          t.value='';         // with more chance of typos
          t.style.color='#fff';
          }
      }

   

    </script>
    
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  
$(document).ready(function(){
    $("#load-btn").on('click',function(e){
        e.preventDefault()
        console.log('click')
        var _currentResult=$(".comment-box").length
        // var _currentResult=2
        console.log(_currentResult)
        blog_id=$(".blogid").val()
        console.log(blog_id)
        $.ajax({
            url:'{% url "loadmore" %}',
            type:'post',
            data:{
                'offset':_currentResult,
                'blog_id':blog_id,
                'csrfmiddlewaretoken':'{{csrf_token}}',
            },
            dataType:'json',
            beforeSend:function(){
                $("#load-btn").addClass('disabled').text('loading')
            },
            success:function(res){
                console.log(res)
                var _html=''
                var json_data=$.parseJSON(res.comment)
                $.each(json_data, function(index,data){

                  
                _html+=`
                  <li style="margin-bottom: 10px;" class="comment-box">
                    <div class="author-thumb">
                      <img style="height: 80px; width: 80px; " src="/images/${data.fields.comment_image}" alt="">
                    </div>
                    <div class="right-content">
                      <h4>${data.fields.name}</h4>
                      <p>${data.fields.body}</p>
                    </div>
                    <br>
                    <br>
                   
                 
                 
                  </li>
                  <br>
                  
                  `



                })
                $(".container-comments").append(_html)
                var _count_total=$(".comment-box").length
                console.log(_count_total)
                if(_count_total>=res.totalResult){
                      $("#load-btn").remove()
                }else{
                    $("#load-btn").removeClass('disabled').text('Load more')
                }
                

            }
        })

    })
})

  $(document).on('click', '#comment-submit', function (e) {
          e.preventDefault()
          console.log('start');
          blog_id=$(".blogid").val()
          console.log(blog_id)
          name=$("#name").val()
          body=$("#body").val()
          console.log(name)
          console.log(body)
          $.ajax({
              type: 'POST',
              url: '{% url "createform" %}',
              data:{
                  name: $("#name").val(),
                  body: $("#body").val(),
                  blog_id:blog_id,
                  'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
              },
              dataType: 'json',
              success: function (response){
                  if (name != "" ){
                      $("#body").val("")
                  }
                  if (body != ""){
                      $("#name").val("")
                  }
                    
                // if (response["total_data"] ==  1)
                //   $(".comment_count").text(response["total_data"] + "Comment")
                var _count_total=$(".comment-box").length
                console.log(response.comment_count)
                if (response.comment_count == 2){
                  $(".comment_count").text(response["comment_count"] + " Comment")
                }
                $(".comment_count").text(response["comment_count"] + " Comments")
                $(".commentfirst").remove()
                if (response.comment_count >= 5){
                    $("#load-btn").show()
                }
                
                console.log(response)
                var _html=''
                // var json_comment=$.parseJSON(res.comments)
                var comment = JSON.parse(response["comments"]);
                var fields = comment[0]["fields"];
                // $(".container-comments").empty()
                // $.each(json_comment, function(index,data){

                _html=`
                
              {% if comment.is_reply == False %}
                  <li class="comment-box">
                    <div class="author-thumb">
                      <img src="{{comment.comment_image.url}}" alt="">
                    </div>
                    <div class="right-content">
                      <h4>{{comment.name}}</h4>
                      <p>{{comment.body|linebreaksbr}}</p>
                    </div>

                  </li><br>
                  {% for reply in comment.replies %}
                      <li style="padding-left: 50px;">
                        <div class="author-thumb">
                          <img src="{{comment.comment_image.url}}" alt="">
                        </div>
                        <div class="right-content">
                          <h4>{{reply.reply_name}}</h4>
                          <p>{{reply.reply_body|linebreaksbr}}</p>
                        </div>

                      </li><br>
                  {% endfor %}

                  <!-- begin reply form -->
                  <form id="comment"  method="POST">
                    {% csrf_token %}

                    <div class="row">
                      {% if request.user.is_authenticated == False %}
                        <fieldset class="col-lg-12">
                          {{form.reply_name.label}}
                          {{form.reply_name}}
                        </fieldset>
                      {% endif %}

                      <fieldset class="col-lg-12">
                        <p>Reply:</p>
                        {{form.reply_body}}
                      </fieldset>
                      
                      <div class="col-lg-12">
                        <fieldset>
                          <input type="hidden" class="reply_id" name="reply_id" value="{{ comment.id }}">
                          <button style="margin-bottom: 20px;" type="submit" id="reply-submit" class="main-button">Submit</button>
                          <br>
                        </fieldset>
                      </div>
                      <br>
                    </div>
                  </form>
                  <!-- endreplyform -->
                
                {% endif %}
                
                <li style="margin-bottom: 10px;"  class="comment-box">
                    <div class="author-thumb">
                      <img style="height: 80px; width: 80px;" src="/images/${fields['comment_image']}" alt="">
                    </div>
                    <div class="right-content">
                      <h4>${fields['name']}</h4>
                      <p>${fields['body']}</p>
                      
                    </div>
                    <br>
                    <br>
                  
                  
                  
                  </li>
                  </li><br>`

                $(".container-comments").prepend(_html)

                
                
                

              },
              error: function(){
                  console.log('error');
              }
          });

      });

    
      $(document).on('click', '#reply-submit', function (e) {
          e.preventDefault()
          console.log('start');
          blog_id=$(".blogid").val()
          reply_id= e.get(value)
          console.log(reply_id)
          $("#reply_name").val("")
          $("#reply_body").val("")
          $.ajax({
              type: 'POST',
              url: '{% url "replyform" %}',
              data:{
                  name: $("#reply_name").val(),
                  body: $("#reply_body").val(),
                  blog_id:blog_id,
                  reply_id:reply_id,
                  'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
              },
              dataType: 'json',
              success: function (response){
               
                console.log(response.sucess)
                console.log(response)
                var _html=''
                // var json_comment=$.parseJSON(res.comments)
                var comment = JSON.parse(response["comments"]);
                var fields = comment[0]["fields"];
                // $(".container-comments").empty()
                // $.each(json_comment, function(index,data){

                _html=``

                $(".container-comments").prepend(_html)

                
                
                

              },
              error: function(){
                  console.log('error');
              }
          });

      });
</script>
     


  

  </body>

</html>
